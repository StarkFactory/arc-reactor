# ===========================================
# Arc Reactor - AI Agent Application
# ===========================================

server:
  port: 8080
  shutdown: graceful

# ----- LLM Providers -----
# Only providers with API keys set will be activated.
# Set keys via environment variables:
#   export GEMINI_API_KEY=your-key
#   export SPRING_AI_OPENAI_API_KEY=your-key
#   export SPRING_AI_ANTHROPIC_API_KEY=your-key
#
# Note: this default app keeps empty fallbacks for local startup/tests.
# In production, provide keys via environment variables (without relying on empty defaults).
spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s
  datasource:
    url: ${SPRING_DATASOURCE_URL:}
    username: ${SPRING_DATASOURCE_USERNAME:}
    password: ${SPRING_DATASOURCE_PASSWORD:}
  flyway:
    enabled: ${SPRING_FLYWAY_ENABLED:false}
  ai:
    google:
      genai:
        api-key: ${GEMINI_API_KEY:}
        chat:
          options:
            model: gemini-2.0-flash
        embedding:
          api-key: ${GEMINI_API_KEY:}
          text:
            options:
              model: gemini-embedding-001
              dimensions: 768
    vectorstore:
      pgvector:
        initialize-schema: ${SPRING_AI_VECTORSTORE_PGVECTOR_INITIALIZE_SCHEMA:false}
        dimensions: 768
    # OpenAI: Set SPRING_AI_OPENAI_API_KEY env var to enable (default model: gpt-4o)
    # Anthropic: Set SPRING_AI_ANTHROPIC_API_KEY env var to enable

# ----- Arc Reactor Agent Settings -----
arc:
  reactor:
    max-tool-calls: 10
    max-tools-per-request: 20

    llm:
      default-provider: gemini
      temperature: 0.7
      max-output-tokens: 4096
      google-search-retrieval-enabled: ${ARC_REACTOR_LLM_GOOGLE_SEARCH_RETRIEVAL_ENABLED:false}

    concurrency:
      max-concurrent-requests: 20
      request-timeout-ms: 30000
      tool-call-timeout-ms: 15000

    guard:
      enabled: true
      rate-limit-per-minute: 20
      rate-limit-per-hour: 200

    boundaries:
      input-min-chars: 1
      input-max-chars: 10000
      system-prompt-max-chars: 0

    rag:
      enabled: ${ARC_REACTOR_RAG_ENABLED:false}
      similarity-threshold: 0.3
      query-transformer: ${ARC_REACTOR_RAG_QUERY_TRANSFORMER:passthrough}
      ingestion:
        enabled: ${ARC_REACTOR_RAG_INGESTION_ENABLED:false}
        dynamic:
          enabled: ${ARC_REACTOR_RAG_INGESTION_DYNAMIC_ENABLED:false}
          refresh-ms: ${ARC_REACTOR_RAG_INGESTION_DYNAMIC_REFRESH_MS:10000}

    error-report:
      enabled: ${ARC_REACTOR_ERROR_REPORT_ENABLED:false}
      api-key: ${ERROR_REPORT_API_KEY:}
      max-concurrent-requests: 3
      request-timeout-ms: 120000
      max-tool-calls: 25

    slack:
      enabled: ${ARC_REACTOR_SLACK_ENABLED:false}
      transport-mode: ${ARC_REACTOR_SLACK_TRANSPORT_MODE:socket_mode}
      bot-token: ${SLACK_BOT_TOKEN:}
      app-token: ${SLACK_APP_TOKEN:}
      signing-secret: ${SLACK_SIGNING_SECRET:}
      socket-backend: ${ARC_REACTOR_SLACK_SOCKET_BACKEND:java_websocket}
      socket-connect-retry-initial-delay-ms: ${ARC_REACTOR_SLACK_SOCKET_CONNECT_RETRY_INITIAL_DELAY_MS:1000}
      socket-connect-retry-max-delay-ms: ${ARC_REACTOR_SLACK_SOCKET_CONNECT_RETRY_MAX_DELAY_MS:30000}
      signature-verification-enabled: ${ARC_REACTOR_SLACK_SIGNATURE_VERIFICATION:true}
      fail-fast-on-saturation: ${ARC_REACTOR_SLACK_FAIL_FAST_ON_SATURATION:true}
      notify-on-drop: ${ARC_REACTOR_SLACK_NOTIFY_ON_DROP:false}
      api-max-retries: ${ARC_REACTOR_SLACK_API_MAX_RETRIES:2}
      api-retry-default-delay-ms: ${ARC_REACTOR_SLACK_API_RETRY_DEFAULT_DELAY_MS:1000}
      event-dedup-enabled: ${ARC_REACTOR_SLACK_EVENT_DEDUP_ENABLED:true}
      event-dedup-ttl-seconds: ${ARC_REACTOR_SLACK_EVENT_DEDUP_TTL_SECONDS:600}
      event-dedup-max-entries: ${ARC_REACTOR_SLACK_EVENT_DEDUP_MAX_ENTRIES:10000}
    discord:
      enabled: ${ARC_REACTOR_DISCORD_ENABLED:false}
      token: ${DISCORD_BOT_TOKEN:}
    line:
      enabled: ${ARC_REACTOR_LINE_ENABLED:false}
      channel-token: ${LINE_CHANNEL_TOKEN:}
      channel-secret: ${LINE_CHANNEL_SECRET:}

# ----- API Documentation -----
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method

# ----- Actuator -----
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true

# ----- Spring WebFlux Multipart (optional override) -----
# Uncomment to cap in-memory buffer before Arc Reactor's per-file limit is evaluated.
# spring:
#   webflux:
#     multipart:
#       max-in-memory-size: 10MB

# ----- Logging -----
logging:
  level:
    com.arc.reactor: INFO
